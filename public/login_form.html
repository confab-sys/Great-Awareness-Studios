<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Login Form</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: #D3E4DE;
            min-height: 100vh;
            width: 100%;
            font-family: 'Public Sans', sans-serif;
            padding: 40px;
        }
        .header-text {
            font-weight: bold;
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }
        .page-title {
            font-weight: bold;
            font-size: 48px;
            color: #333;
            line-height: 1.2;
            margin-bottom: 40px;
        }
        .content-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
        }
        .form-container {
            background: #D3E4DE;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #E42F45;
            color: #000;
        }
        .form-group input:focus {
            outline: none;
            border-color: #007BFF;
        }
        .login-button {
            width: 100%;
            padding: 15px;
            background-color: #E42F45;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            font-family: 'Public Sans', sans-serif;
            font-weight: bold;
            margin-top: 20px;
        }
        .login-button:hover {
            background-color: #B22439;
        }

        .back-link {
            text-align: center;
            margin-top: 20px;
        }
        .back-link a {
            color: #E42F45;
            text-decoration: none;
            font-weight: bold;
        }
        .error-message {
            color: #E42F45;
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
        }
        .success-message {
            color: #28a745;
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="header-text">Great Awareness</div>
    <div class="page-title">Welcome Back! Login</div>
    
    <div class="content-container">
        <div class="form-container">
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="location">County</label>
                    <select id="location" name="location" required style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; background-color: #E42F45; color: #000;">
                        <option value="">Select your county</option>
                        <option value="Baringo">Baringo</option>
                        <option value="Bomet">Bomet</option>
                        <option value="Bungoma">Bungoma</option>
                        <option value="Busia">Busia</option>
                        <option value="Elgeyo-Marakwet">Elgeyo-Marakwet</option>
                        <option value="Embu">Embu</option>
                        <option value="Garissa">Garissa</option>
                        <option value="Homa Bay">Homa Bay</option>
                        <option value="Isiolo">Isiolo</option>
                        <option value="Kajiado">Kajiado</option>
                        <option value="Kakamega">Kakamega</option>
                        <option value="Kericho">Kericho</option>
                        <option value="Kiambu">Kiambu</option>
                        <option value="Kilifi">Kilifi</option>
                        <option value="Kirinyaga">Kirinyaga</option>
                        <option value="Kisii">Kisii</option>
                        <option value="Kisumu">Kisumu</option>
                        <option value="Kitui">Kitui</option>
                        <option value="Kwale">Kwale</option>
                        <option value="Laikipia">Laikipia</option>
                        <option value="Lamu">Lamu</option>
                        <option value="Machakos">Machakos</option>
                        <option value="Makueni">Makueni</option>
                        <option value="Mandera">Mandera</option>
                        <option value="Marsabit">Marsabit</option>
                        <option value="Meru">Meru</option>
                        <option value="Migori">Migori</option>
                        <option value="Mombasa">Mombasa</option>
                        <option value="Muranga">Muranga</option>
                        <option value="Nairobi">Nairobi</option>
                        <option value="Nakuru">Nakuru</option>
                        <option value="Nandi">Nandi</option>
                        <option value="Narok">Narok</option>
                        <option value="Nyamira">Nyamira</option>
                        <option value="Nyandarua">Nyandarua</option>
                        <option value="Samburu">Samburu</option>
                        <option value="Siaya">Siaya</option>
                        <option value="Taita–Taveta">Taita–Taveta</option>
                        <option value="Tana River">Tana River</option>
                        <option value="Tharaka-Nithi">Tharaka-Nithi</option>
                        <option value="Trans-Nzoia">Trans-Nzoia</option>
                        <option value="Turkana">Turkana</option>
                        <option value="Uasin Gishu">Uasin Gishu</option>
                        <option value="Vihiga">Vihiga</option>
                        <option value="Wajir">Wajir</option>
                        <option value="West Pokot">West Pokot</option>
                    </select>
                </div>
                <div id="errorMessage" class="error-message" style="display: none;"></div>
                <div id="successMessage" class="success-message" style="display: none;"></div>
            </form>
        </div>
        <button class="login-button" id="loginBtn">Login</button>
        <div class="back-link">
            <a href="index.html">← Back to Home</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDLeIOTXOQ5pY2R5ZrdnLSTGNpEO1buw0k",
            authDomain: "great-awareness-studio.firebaseapp.com",
            projectId: "great-awareness-studio",
            storageBucket: "great-awareness-studio.firebasestorage.app",
            messagingSenderId: "999019465651",
            appId: "1:999019465651:web:3e8b5ab1cd0fa74dc219c6",
            measurementId: "G-9J2PG61TW7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function showMessage(message, isError = false) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            
            if (isError) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
            } else {
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                errorDiv.style.display = 'none';
            }
        }

        async function loginUser() {
            const email = document.getElementById('email').value;
            const location = document.getElementById('location').value;

            if (!email || !location) {
                showMessage('Please fill in all fields', true);
                return;
            }

            try {
                const usersRef = collection(db, 'users');
                const q = query(usersRef, where("email", "==", email), where("location", "==", location));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    showMessage('User not found. Please check your email and county or create an account.', true);
                    return;
                }

                const userDoc = querySnapshot.docs[0];
                const userData = userDoc.data();
                
                showMessage('Login successful! Welcome back, ' + userData.name + '!');
                
                localStorage.setItem('currentUser', JSON.stringify({
                    id: userDoc.id,
                    name: userData.name,
                    email: userData.email,
                    mobile: userData.mobile,
                    location: userData.location
                }));
                
                setTimeout(() => {
                    window.location.href = 'welcome_page.html';
                }, 2000);

            } catch (error) {
                console.error('Error during login: ', error);
                showMessage('Error during login: ' + error.message, true);
            }
        }



        window.addEventListener('load', function() {
            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) {
                loginBtn.addEventListener('click', loginUser);
            }

            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        loginUser();
                    }
                });
            }
        });
    </script>
</body>
</html>
